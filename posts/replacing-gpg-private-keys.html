---
title: Replacing GPG private keys
author: A.I.
categories: life privacy
language: en
date: 2020-05-10
---
<p>
<a href="https://keybase.io/blog/keybase-joins-zoom">Keybase is acquired by Zoom</a> on May 7, 2020.
</p>

<p>
Although I don&rsquo;t have any evidence why Zoom is not trustworthy, I just don&rsquo;t. I deleted my account immediately after I saw the news. Since my private keys are all generated by keybase cli and have been synced with it, so I think it&rsquo;s a good idea to replace them as well.
</p>

<p>
I currently only use gpg key with pass, git commit sign, an <code>.authinfo.gpg</code> file used by emacs, and a <code>.mailpass.gpg</code> file used by <code>mbsync</code>.
</p>

<div id="outline-container-org7f49c3d" class="outline-2">
<h2 id="org7f49c3d">Generate new keys.</h2>
<div class="outline-text-2" id="text-org7f49c3d">
<p>
This is pretty straightforward, just run <code>gpg --full-gen-key</code> and follow the instructions, I&rsquo;m using RSA and RSA with 4096 bits keysize and no expire options.
</p>

<p>
Do this twice to generate two keys, one for personal use, and one for sign git commits for work.
</p>

<p>
Find out the &lt;new-key-id&gt; with <code>gpg --list-secret-keys</code>.
</p>
</div>
</div>

<div id="outline-container-orgaccdf87" class="outline-2">
<h2 id="orgaccdf87">Re-encrypt the password store.</h2>
<div class="outline-text-2" id="text-orgaccdf87">
<p>
First check for <code>.gpg-id</code> file in the password store directory, if it exists, it should contain the old gpg key-id, just remove it. The just run a <code>pass init</code> with newly generated key to re-encrypt all password files in it.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #29838D; font-weight: bold;">cd</span> .password-store
<span style="color: #5d86b6; font-weight: bold;">rm</span> .gpg-id
<span style="color: #5d86b6; font-weight: bold;">pass</span> init <span style="color: #3B6EA8;">&lt;</span>new-key-id<span style="color: #3B6EA8;">&gt;</span>
</pre>
</div>

<p>
references: <a href="https://askubuntu.com/questions/929307/how-to-change-the-gpg-key-of-the-pass-password-store">pgp - How to change the gpg key of the pass password store - Ask Ubuntu</a>
</p>
</div>
</div>

<div id="outline-container-orgcaeb791" class="outline-2">
<h2 id="orgcaeb791">Change git commit signing key.</h2>
<div class="outline-text-2" id="text-orgcaeb791">
<p>
I have multiple git config with <code>gitdir:</code> config, just update all <code>.gitconfig</code> files, replacing the old key id with the new one. If only one git config is used, it can also be changed in terminal.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5d86b6; font-weight: bold;">git</span> config user.signingkey <span style="color: #3B6EA8;">&lt;</span>new-key-id<span style="color: #3B6EA8;">&gt;</span>
</pre>
</div>

<p>
Get a public key export by running
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--export</span> <span style="color: #97365B;">--armor</span> <span style="color: #3B6EA8;">&lt;</span>new-key-id<span style="color: #3B6EA8;">&gt;</span> <span style="color: #3B6EA8;">|</span> pbcopy
</pre>
</div>

<blockquote>
<p>
<code>pbcopy</code> is a wrapper I use for save stdout to clipboard.
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #8b94a5;">#!/bin/</span><span style="color: #3B6EA8;">bash</span>
<span style="color: #3B6EA8;">if</span> <span style="color: #3B6EA8;">[</span><span style="color: #97365B;">[</span> <span style="color: #3B6EA8;">$</span><span style="color: #4F894C;">(</span><span style="color: #3B6EA8; font-weight: bold;">uname</span><span style="color: #4F894C;">)</span> <span style="color: #3B6EA8;">==</span> <span style="color: #4F894C;">"Darwin"</span> <span style="color: #97365B;">]</span><span style="color: #3B6EA8;">]</span><span style="color: #3B6EA8;">;</span> <span style="color: #3B6EA8;">then</span>
    <span style="color: #5d86b6; font-weight: bold;">/usr/bin/pbcopy</span>
<span style="color: #3B6EA8;">else</span>
    <span style="color: #5d86b6; font-weight: bold;">xclip</span> <span style="color: #97365B;">-i</span> <span style="color: #97365B;">-sel</span> c <span style="color: #97365B;">-f</span> <span style="color: #3B6EA8;">|</span><span style="color: #5d86b6; font-weight: bold;">xclip</span> <span style="color: #97365B;">-i</span> <span style="color: #97365B;">-sel</span> p
<span style="color: #3B6EA8;">fi</span>
</pre>
</div>
</blockquote>

<p>
Then go to GitHub/GitLab or any other service needed, add the new pubkey and remove the old key from GPG Key Settings.
</p>
</div>
</div>

<div id="outline-container-orga80615f" class="outline-2">
<h2 id="orga80615f">Other files encrypted with gpg.</h2>
<div class="outline-text-2" id="text-orga80615f">
<p>
Just do a decrypt and encrypt.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--decrypt</span> <span style="color: #97365B;">-o</span> authinfo.txt .authinfo.gpg
<span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--encrypt</span> <span style="color: #97365B;">-o</span> .authinfo.gpg <span style="color: #97365B;">--default-key</span> <span style="color: #3B6EA8;">&lt;</span>new-key-id<span style="color: #3B6EA8;">&gt;</span> authinfo.txt
<span style="color: #5d86b6; font-weight: bold;">rm</span> authinfo.txt

<span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--decrypt</span> <span style="color: #97365B;">-o</span> mailpass.txt .mailpass.gpg
<span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--encrypt</span> <span style="color: #97365B;">-o</span> .mailpass.gpg <span style="color: #97365B;">--default-key</span> <span style="color: #3B6EA8;">&lt;</span>new-key-id<span style="color: #3B6EA8;">&gt;</span> mailpass.txt
<span style="color: #5d86b6; font-weight: bold;">rm</span> mailpass.txt
</pre>
</div>
</div>
</div>

<div id="outline-container-org1818187" class="outline-2">
<h2 id="org1818187">Remove the old gpg key.</h2>
<div class="outline-text-2" id="text-org1818187">
<p>
Backup keys in case of something missing from the above steps.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--export</span> <span style="color: #97365B;">--armor</span> <span style="color: #3B6EA8;">&lt;</span>old-key-id<span style="color: #3B6EA8;">&gt;</span> <span style="color: #3B6EA8;">&gt;</span> old_pubkey.asc
<span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--export-secret-keys</span> <span style="color: #97365B;">--armor</span> <span style="color: #3B6EA8;">&lt;</span>old-key-id<span style="color: #3B6EA8;">&gt;</span> <span style="color: #3B6EA8;">&gt;</span> old_privkey.asc
<span style="color: #5d86b6; font-weight: bold;">gpg</span> <span style="color: #97365B;">--delete-secret-and-public-key</span> <span style="color: #3B6EA8;">&lt;</span>old-key-id<span style="color: #3B6EA8;">&gt;</span>
</pre>
</div>

<p>
There will be a lot of popups, just hit delete üôÇÔ∏è.
</p>
</div>
</div>

<div id="outline-container-org39d111d" class="outline-2">
<h2 id="org39d111d">Conclusion</h2>
<div class="outline-text-2" id="text-org39d111d">
<p>
It&rsquo;s quite easy I&rsquo;d say, definitely easier than replacing an Email address or phone number. Be safe.
</p>
</div>
</div>
